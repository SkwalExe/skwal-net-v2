server {
        listen 80;
        return 301 https://$host$request_uri;
}


server {
        listen 443 ssl;
        server_name skwal.net;

        error_page 503 /maintenance.html;

        location /maintenance.html {
                root /home/skwal/skwal-net-v2/extra/;
                internal;
        }

        location /static/ {
                alias /home/skwal/skwal-net-v2/skwal_net/static/;
        }

        location / {
                if (-f /home/skwal/skwal-net-v2/hooks/maintenance) {
                        return 503;
                }
                proxy_pass http://127.0.0.1:8000;
        }
        ssl_certificate /etc/letsencrypt/live/skwal.net/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/skwal.net/privkey.pem; # managed by Certbot
        include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

server {
	listen 443;
	server_name github.skwal.net;
	ssl_certificate /etc/letsencrypt/live/sub.skwal.net/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/sub.skwal.net/privkey.pem;
	return 301 https://github.com/SkwalExe;
}

server {
        listen 443;
        server_name mail.skwal.net;

        root /var/www/html;
        index index.php index.html;
        include /etc/nginx/templates/misc.tmpl;
        include /etc/nginx/templates/ssl.tmpl;
        include /etc/nginx/templates/iredadmin.tmpl;
        include /etc/nginx/templates/roundcube.tmpl;
        # include /etc/nginx/templates/sogo.tmpl;
        # include /etc/nginx/templates/netdata.tmpl;
        include /etc/nginx/templates/php-catchall.tmpl;
        # include /etc/nginx/templates/stub_status.tmpl;

        ssl_certificate /etc/letsencrypt/live/sub.skwal.net/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/sub.skwal.net/privkey.pem; # managed by Certbot
}

# redirect www.skwal.net request to skwal.net requests
server {
        listen 443;
        server_name www.skwal.net;
        ssl_certificate /etc/letsencrypt/live/sub.skwal.net/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/sub.skwal.net/privkey.pem; # managed by Certbot
        return 301 https://skwal.net$request_uri;
}       

# server for non-defined subdomains
server {
        listen 443 default_server;
        server_name _;
        ssl_certificate /etc/letsencrypt/live/sub.skwal.net/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/sub.skwal.net/privkey.pem; # managed by Certbot
        return 200 "I AM ON FIRE $host";

}
